knitr::opts_chunk$set(echo = TRUE)
fnb <- read.csv("data/data-train.csv")
fnb
fnb <- fnb %>% select(transaction_date, receipt_number)
library(tidyverse)
library(ggfortify)
library(lubridate)
fnb <- fnb %>% select(transaction_date, receipt_number)
fnb
fnb$transaction_date <- ymd_hms(fnb$transaction_date)
fnb
fnb <- fnb %>%
mutate(transaction_date = floor_date(x = .$transaction_date, unit = "hour"))
fnb
fnb <- fnb %>%
group_by(receipt_number, transaction_date) %>%
summarise(demand = n_distinct()) %>%
ungroup()
fnb <- fnb %>%
group_by(receipt_number, transaction_date) %>%
summarise(demand = n_distinct(receipt_number)) %>%
ungroup()
fnb <- read.csv("data/data-train.csv")
fnb <- fnb %>% select(transaction_date, receipt_number)
fnb$transaction_date <- ymd_hms(fnb$transaction_date)
fnb <- fnb %>%
mutate(transaction_date = floor_date(x = .$transaction_date, unit = "hour"))
fnb
fnb <- fnb %>%
group_by(receipt_number, transaction_date) %>%
summarise(demand = n_distinct(receipt_number)) %>%
ungroup()
fnb
fnb <- read.csv("data/data-train.csv")
fnb <- fnb %>% select(transaction_date, receipt_number)
fnb$transaction_date <- ymd_hms(fnb$transaction_date)
fnb <- fnb %>%
mutate(transaction_date = floor_date(x = .$transaction_date, unit = "hour"))
fnb <- fnb %>%
group_by(transaction_date) %>%
summarise(visitor = n_distinct(receipt_number)) %>%
ungroup()
fnb
fnb %>% mutate(day = ymd(transaction_date),
time = hour(transaction_date))
fnb %>% mutate(day = ymd(.$transaction_date),
time = hms(.$transaction_date))
ymd(fnb$transaction_date[1])
year(fnb$transaction_date[1])
day(fnb$transaction_date[1])
days(fnb$transaction_date[1])
days_in_month(fnb$transaction_date[1])
day(fnb$transaction_date[1])
fnb$transaction_date[1]
class(fnb$transaction_date[1])
paste(year(fnb$transaction_date[1]), month(fnb$transaction_date[1]), day(fnb$transaction_date[1]))
paste(year(fnb$transaction_date[1]), month(fnb$transaction_date[1]), day(fnb$transaction_date[1]), sep = "-")
ymd(paste(year(fnb$transaction_date[1]), month(fnb$transaction_date[1]), day(fnb$transaction_date[1]), sep = "-"))
fnb$time <-
hour(fnb$transaction_date[1])
fnb
fnb$time <-
hour(fnb$transaction_date[1])
hour(fnb$transaction_date[1])
hms(hour(fnb$transaction_date[1]))
hms(paste(hour(fnb$transaction_date[1]), 0, 0, sep = ":"))
fnb$time <- hms(paste(hour(fnb$transaction_date[1]), 0, 0, sep = ":"))
fnb
fnb$date <- ymd(paste(year(fnb$transaction_date[1]),
month(fnb$transaction_date[1]),
day(fnb$transaction_date[1]),
sep = "-"))
fnb
day(fnb$transaction_date[1], label = T)
day(fnb$transaction_date[1], label = TRUE)
date(x = fnb$transaction_date[1], label = T)
wday(x = fnb$transaction_date[1], label = T, abbr = F)
fnb$day <- wday(x = fnb$transaction_date[1], label = T, abbr = F)
fnb
fnb %>% ggplot(aes(x = transaction_date, y = visitor)) +
geom_col(aes(fill = day))
wday(x = fnb$transaction_date[1])
wday(x = fnb$transaction_date[20])
fnb$date <- ymd(paste(year(fnb$transaction_date),
month(fnb$transaction_date),
day(fnb$transaction_date),
sep = "-"))
fnb$time <- hms(paste(hour(fnb$transaction_date), 0, 0, sep = ":"))
fnb$day <- wday(x = fnb$transaction_date, label = T, abbr = F)
fnb
fnb %>% ggplot(aes(x = transaction_date, y = visitor)) +
geom_col(aes(fill = day))
fnb %>% ggplot(aes(x = transaction_date, y = visitor)) +
geom_col(fill = day)
fnb %>% ggplot(aes(x = transaction_date, y = visitor)) +
geom_col(aes(fill = day))
fnb %>% ggplot(aes(x = time(), y = visitor)) +
geom_col(aes(fill = day))
fnb %>% ggplot(aes(x = time, y = visitor)) +
geom_col(aes(fill = day))
anyNA(fnb)
min_date <- min(fnb$transaction_date)
max_date <- max(fnb$transaction_date)
start_val <- make_datetime(year = year(min_date), month = month(min_date), day = day(min_date), hour = hour(min_date))
end_val <- make_datetime(year = year(max_date), month = month(max_date), day = day(max_date), hour = hour(max_date))
fnb_pad <- padr::pad(x = fnb, start_val = start_val, end_val = end_val)
fnb <- read.csv("data/data-train.csv")
fnb <- fnb %>% select(transaction_date, receipt_number)
fnb$transaction_date <- ymd_hms(fnb$transaction_date)
fnb <- fnb %>%
mutate(transaction_date = floor_date(x = .$transaction_date, unit = "hour"))
fnb <- fnb %>%
group_by(transaction_date) %>%
summarise(visitor = n_distinct(receipt_number)) %>%
ungroup()
min_date <- min(fnb$transaction_date)
max_date <- max(fnb$transaction_date)
start_val <- make_datetime(year = year(min_date), month = month(min_date), day = day(min_date), hour = hour(min_date))
end_val <- make_datetime(year = year(max_date), month = month(max_date), day = day(max_date), hour = hour(max_date))
fnb
fnb_pad <- padr::pad(x = fnb, start_val = start_val, end_val = end_val)
fnb
anyNA(fnb)
fnb_pad$visitor <- replace_na(fnb_pad$visitor, 0)
fnb$date <- ymd(paste(year(fnb$transaction_date),
month(fnb$transaction_date),
day(fnb$transaction_date),
sep = "-"))
fnb$time <- hms(paste(hour(fnb$transaction_date), 0, 0, sep = ":"))
fnb$day <- wday(x = fnb$transaction_date, label = T, abbr = F)
fnb
fnb %>% ggplot(aes(x = time, y = visitor)) +
geom_col(aes(fill = day))
fnb %>% ggplot(aes(x = time, y = visitor)) +
geom_histogram(aes(fill = day))
fnb %>% ggplot(aes(x = time, y = visitor)) +
geom_line(aes(fill = day))
fnb %>% ggplot(aes(x = time, y = visitor)) +
geom_boxplot(aes(fill = day))
fnb %>% ggplot(aes(x = day, y = visitor)) +
geom_()
fnb %>% ggplot(aes(x = day, y = visitor)) +
geom_col()
fnb %>% ggplot(aes(x = day, y = visitor)) +
geom_col(aes(fill = hour(time)))
fnb %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day))
fnb %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day)) +
theme_classic()
fnb %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day)) +
theme_minimal()
fnb %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day)) +
theme_minimal() +
labs(title = "Number of visitors",
x = "Hour",
y = "Number of visitors",
fill = "Day")
anyNA(fnb_pad)
fnb_ts <- ts(data = fnb_pad$visitor, start = c(2017,12,1), frequency = 13)
autoplot(fnb_ts)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ts <- ts(data = fnb_pad$visitor, start = c(2017,12,1), frequency = 24)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_pad$date <- ymd(paste(year(fnb_pad$transaction_date),
month(fnb_pad$transaction_date),
day(fnb_pad$transaction_date),
sep = "-"))
fnb_pad$time <- hms(paste(hour(fnb_pad$transaction_date), 0, 0, sep = ":"))
fnb_pad$day <- wday(x = fnb_pad$transaction_date, label = T, abbr = F)
fnb_pad %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day)) +
theme_minimal() +
labs(title = "Number of visitors",
x = "Hour",
y = "Number of visitors",
fill = "Day")
fnb_pad
min(fnb$transaction_date)
min_date
max_date
hour("00:00:00")
hour(hms("00:00:00"))
hms("00:00:00")
start_val <- make_datetime(year = year(min_date), month = month(min_date), day = day(min_date), hour = hour(hms("00:00:00")))
end_val <- make_datetime(year = year(max_date), month = month(max_date), day = day(max_date), hour = hour(max_date))
fnb_pad <- padr::pad(x = fnb, start_val = start_val, end_val = end_val)
start_val
end_val
fnb_pad <- padr::pad(x = fnb, start_val = start_val, end_val = end_val)
fnb <- read.csv("data/data-train.csv")
fnb <- fnb %>% select(transaction_date, receipt_number)
fnb$transaction_date <- ymd_hms(fnb$transaction_date)
fnb <- fnb %>%
mutate(transaction_date = floor_date(x = .$transaction_date, unit = "hour"))
fnb <- fnb %>%
group_by(transaction_date) %>%
summarise(visitor = n_distinct(receipt_number)) %>%
ungroup()
min_date <- min(fnb$transaction_date)
max_date <- max(fnb$transaction_date)
start_val <- make_datetime(year = year(min_date), month = month(min_date), day = day(min_date), hour = hour(hms("00:00:00")))
end_val <- make_datetime(year = year(max_date), month = month(max_date), day = day(max_date), hour = hour(max_date))
fnb_pad <- padr::pad(x = fnb, start_val = start_val, end_val = end_val)
fnb_pad
fnb_pad$visitor <- replace_na(fnb_pad$visitor, 0)
fnb_pad
fnb_pad$date <- ymd(paste(year(fnb_pad$transaction_date),
month(fnb_pad$transaction_date),
day(fnb_pad$transaction_date),
sep = "-"))
fnb_pad$time <- hms(paste(hour(fnb_pad$transaction_date), 0, 0, sep = ":"))
fnb_pad$day <- wday(x = fnb_pad$transaction_date, label = T, abbr = F)
fnb_pad %>% ggplot(aes(x = hour(time), y = visitor)) +
geom_col(aes(fill = day)) +
theme_minimal() +
labs(title = "Number of visitors",
x = "Hour",
y = "Number of visitors",
fill = "Day")
fnb_ts <- ts(data = fnb_pad$visitor, start = c(2017,12,1), frequency = 24)
autoplot(fnb_ts)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ts <- ts(data = fnb_pad$visitor, start = c(2017,12,1), frequency = 24*7)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ts <- ts(data = fnb_pad$visitor, frequency = 24*7)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ts <- ts(data = fnb_pad$visitor, frequency = 24*7*4)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ts <- ts(data = fnb_pad$visitor, frequency = 24*7)
decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_ets <- forecast::ets(y = fnb_ts, model = "ZZZ")
fnb_dec <- decompose(x = fnb_ts, type = "additive") %>% autoplot()
fnb_dec <- decompose(x = fnb_ts, type = "additive")
shapiro.test(fnb_dec$random)
Box.test(fnb_dec$random)
hist(fnb_dec$random)
shapiro.test(fnb_dec$random)
Box.test(fnb_dec$random)
# split train-validation 1 seasonal
train <- head(fnb_ts, length(fnb_ts) - 24 * 7)
validation <- tail(fnb_ts, 24 * 7)
# split train-validation 1 seasonal
train <- head(fnb_ts, length(fnb_ts) - 24 * 7)
validation <- tail(fnb_ts, 24 * 7)
model_holt<- HoltWinters(train, seasonal = "additive")
forecast_holt <- forecast::forecast(model_holt, h = 24 * 7)
MLmetrics::MAE(y_pred = forecast_holt$mean, y_true = validation)
TSstudio::plot_forecast(forecast_holt) #, title = "Model Complex Seasonality")
TSstudio::test_forecast(actual = fnb_ts, forecast.obj = forecast_holt,
train = train, test = validation)
model_arima <- forecast::auto.arima(train)
